import React, { useState, useRef, useEffect, memo } from 'react';\nimport { getOptimizedImageUrl } from '../../utils/performance';\n\nconst OptimizedImage = memo(({ \n  src, \n  alt, \n  width, \n  height, \n  className = '', \n  loading = 'lazy',\n  sizes = '100vw',\n  quality = 75,\n  placeholder = 'blur',\n  ...props \n}) => {\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [error, setError] = useState(false);\n  const imgRef = useRef(null);\n\n  // Generate optimized image URLs\n  const optimizedSrc = getOptimizedImageUrl(src, width, height);\n  const placeholderSrc = placeholder === 'blur' \n    ? `data:image/svg+xml,%3Csvg width='${width || 400}' height='${height || 300}' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='100%25' height='100%25' fill='%23f3f4f6'/%3E%3C/svg%3E`\n    : '';\n\n  useEffect(() => {\n    const img = imgRef.current;\n    if (!img) return;\n\n    const handleLoad = () => {\n      setIsLoaded(true);\n    };\n\n    const handleError = () => {\n      setError(true);\n    };\n\n    img.addEventListener('load', handleLoad);\n    img.addEventListener('error', handleError);\n\n    // Use Intersection Observer for lazy loading\n    if (loading === 'lazy' && 'IntersectionObserver' in window) {\n      const observer = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if (entry.isIntersecting) {\n              img.src = optimizedSrc;\n              observer.unobserve(img);\n            }\n          });\n        },\n        {\n          rootMargin: '50px 0px',\n          threshold: 0.01\n        }\n      );\n\n      observer.observe(img);\n\n      return () => {\n        observer.disconnect();\n        img.removeEventListener('load', handleLoad);\n        img.removeEventListener('error', handleError);\n      };\n    } else {\n      img.src = optimizedSrc;\n    }\n\n    return () => {\n      img.removeEventListener('load', handleLoad);\n      img.removeEventListener('error', handleError);\n    };\n  }, [optimizedSrc, loading]);\n\n  if (error) {\n    return (\n      <div \n        className={`image-error-placeholder ${className}`}\n        style={{ \n          width: width || '100%', \n          height: height || 'auto',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          backgroundColor: '#f3f4f6',\n          color: '#6b7280'\n        }}\n      >\n        <span>Image not available</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"optimized-image-container\" style={{ position: 'relative' }}>\n      {!isLoaded && placeholder && (\n        <div \n          className=\"image-placeholder\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            width: '100%',\n            height: '100%',\n            backgroundColor: '#f3f4f6',\n            backgroundImage: placeholderSrc ? `url(${placeholderSrc})` : 'none',\n            backgroundSize: 'cover',\n            backgroundPosition: 'center',\n            filter: 'blur(2px)',\n            transition: 'opacity 0.3s ease'\n          }}\n        />\n      )}\n      <img\n        ref={imgRef}\n        alt={alt}\n        className={`${className} ${isLoaded ? 'loaded' : 'loading'}`}\n        style={{\n          opacity: isLoaded ? 1 : 0,\n          transition: 'opacity 0.3s ease',\n          width: width || '100%',\n          height: height || 'auto'\n        }}\n        loading={loading}\n        sizes={sizes}\n        {...props}\n      />\n      <style jsx>{`\n        .optimized-image-container {\n          overflow: hidden;\n        }\n        .image-placeholder {\n          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n        @keyframes pulse {\n          0%, 100% {\n            opacity: 1;\n          }\n          50% {\n            opacity: 0.5;\n          }\n        }\n      `}</style>\n    </div>\n  );\n});\n\nOptimizedImage.displayName = 'OptimizedImage';\n\nexport default OptimizedImage;
